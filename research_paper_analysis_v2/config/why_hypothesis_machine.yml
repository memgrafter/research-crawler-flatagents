spec: flatmachine
spec_version: "1.0.0"

data:
  name: why-hypothesis
  profiles: ./profiles.yml

  agents:
    writer: ./why_hypothesis_writer.yml

  context:
    # Capture inbound machine input into local context (required for agent input mapping)
    title: input.title
    key_outcome: input.key_outcome
    abstract: input.abstract
    paper_text: input.paper_text
    corpus_signals: input.corpus_signals
    corpus_neighbors: input.corpus_neighbors
    token_target_why: input.token_target_why

    result: null

  states:
    start:
      type: initial
      transitions:
        - to: write

    write:
      agent: writer
      execution:
        type: default
      input:
        title: context.title
        key_outcome: context.key_outcome
        abstract: context.abstract
        paper_text: context.paper_text
        corpus_signals: context.corpus_signals
        corpus_neighbors: context.corpus_neighbors
        token_target: context.token_target_why
      output_to_context:
        result: output.content
      transitions:
        - to: done

    done:
      type: final
      output:
        content: context.result

metadata:
  description: "Wrapper machine for why_hypothesis_writer (expensive model)"
