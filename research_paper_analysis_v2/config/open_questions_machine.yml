spec: flatmachine
spec_version: "1.0.0"

data:
  name: open-questions
  profiles: ./profiles.yml

  agents:
    writer: ./open_questions_writer.yml

  context:
    # Capture inbound machine input into local context (required for agent input mapping)
    title: input.title
    key_outcome: input.key_outcome
    abstract: input.abstract
    paper_text: input.paper_text
    token_target_open_questions: input.token_target_open_questions

    result: null

  states:
    start:
      type: initial
      transitions:
        - to: write

    write:
      agent: writer
      execution:
        type: retry
        backoffs: [2, 8, 16, 35]
      input:
        title: context.title
        key_outcome: context.key_outcome
        abstract: context.abstract
        paper_text: context.paper_text
        token_target: context.token_target_open_questions
      output_to_context:
        result: output.content
      transitions:
        - to: done

    done:
      type: final
      output:
        content: context.result

metadata:
  description: "Wrapper machine for open_questions_writer (expensive model)"
